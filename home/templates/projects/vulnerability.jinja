{% extends 'base.jinja' %}
{% block title %}Hermes - {{ project.title }}{% endblock %}
{% block content %}
    <div class="page">
        {% include 'projects/header.jinja' %}
        <div class="page-wrapper">
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <h2 class="page-title">
                                {{ vuln_title }}
                            </h2><br>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page body -->
            <div class="page-body">
                <div class="container-xl">
                    {% include 'alerts.jinja' %}
                    <form action="/projects/{{ project.uuid }}/vulnerabilities/{{ vuln.uuid }}/attributes" method="POST"
                          enctype="multipart/form-data">
                        {{ csrf_input|safe }}
                        <div class="row row-cards row-deck">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">

                                            The following information relates to a vulnerability found on
                                            <b>{{ project.title }}</b>:
                                            {#                                        <br>#}
                                            {#                                        <br>#}
                                            {#                                        {{ vuln.description }}#}
                                        </h3>
                                    </div>
                                    <div class="card-footer">
                                        Vulnerability found at
                                        <b>{{ profile.localize_dt(vuln.created_at)|fmt('full') }}</b>
                                        <div class="float-end">
                                            <a href="/projects/{{ project.uuid }}/vulnerabilities/{{ next_vuln_id }}">View
                                                Next Vulnerability</a>

                                        </div>
                                    </div>

                                    <div class="card-body">
                                        <div class="datagrid">
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Scanner</div>
                                                <div class="datagrid-content">{{ vuln.found_by|capitalize }}</div>
                                            </div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">State</div>
                                                <select type="text" class="form-select" name="state" id="state">
                                                    <option value="New"{% if vuln.state == "New" %}
                                                            selected="selected"{% endif %}>New
                                                    </option>
                                                    <option value="Under Triage"{% if vuln.state == "Under Triage" %}
                                                            selected="selected"{% endif %}>Under Triage
                                                    </option>
                                                    <option value="Resolved"{% if vuln.state == "Resolved" %}
                                                            selected="selected"{% endif %}>Resolved
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Exploitability</div>
                                                <select type="text" class="form-select" name="exploitability"
                                                        id="exploitability">
                                                    <option value="Unknown"{% if vuln.exploitability == "Unknown" %}
                                                            selected="selected"{% endif %}>Unknown
                                                    </option>
                                                    <option value="Exploitable"
                                                            {% if vuln.exploitability == "Exploitable" %}
                                                            selected="selected"{% endif %}>Exploitable
                                                    </option>
                                                    <option value="Not Exploitable"
                                                            {% if vuln.exploitability == "Not Exploitable" %}
                                                            selected="selected"{% endif %}>Not Exploitable
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Save drop downs</div>
                                                <div class="datagrid-content">
                                                    <button type="submit" class="btn btn-outline-teal">Save Attributes
                                                    </button>
                                                </div>

                                            </div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Impact</div>
                                                <div class="datagrid-content">{{ vuln.impact }}</div>
                                            </div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Likelihood</div>
                                                <div class="datagrid-content">{{ vuln.likelihood }}</div>
                                            </div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Severity</div>
                                                <div class="datagrid-content">{{ vuln.severity }}</div>
                                            </div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Confidence</div>
                                                <div class="datagrid-content">{{ vuln.confidence }}</div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="page-body">
                <div class="container-xl">
                    <div class="row justify-content-center">
                        <div class="card col-12">
                            <div class="card-body markdown">
                                <div class="card-header">
                                    <ul class="nav nav-tabs card-header-tabs" data-bs-toggle="tabs">
                                        <li class="nav-item">
                                            <a href="#tabs-home-1" class="nav-link active" data-bs-toggle="tab">Details</a>
                                        </li>
                                        {% if vuln.extra_metadata != {} %}
                                            <li class="nav-item">
                                                <a href="#tabs-output-1" class="nav-link" data-bs-toggle="tab">Raw
                                                    Output</a>
                                            </li>
                                        {% endif %}

                                    </ul>
                                </div>
                                <div class="card-body">
                                    <div class="tab-content">
                                        <div class="tab-pane active show" id="tabs-home-1">
                                        <h3>Vulnerability Details</h3>
                                            {% for line in vuln.description.splitlines() -%}
                                                <p>{{ line }}</p>
                                            {% endfor -%}
                                            <p>
                                                The issue lives on line <b>{{ vuln.code_line }}</b> within
                                                <b>{{ vuln.code_file }}</b>
                                            </p>
                                            <div class="highlight">
                                                <pre class="highlight"><code>{{ vuln.code_context }}</code></pre>
                                            </div>
                                        <br>
                                        <form method="post" action="/projects/{{ project.uuid }}/vulnerabilities/{{ vuln.uuid }}/notes">
                                            <h2>User provided notes on this vulnerability</h2>
                                            Any notes you may have stored on this vulnerability are stored here:
                                            <button type="submit" class="btn btn-outline-primary float-end">Save Notes</button>
                                            <br>
                                            {{ csrf_input|safe }}
                                            <label for="notes"></label><textarea class="form-control" rows="8" name="notes" id="notes">{{ vuln.notes }}</textarea>
                                        </form>
                                        </div>
                                        {% if vuln.extra_metadata != {} %}
                                            <div class="tab-pane" id="tabs-output-1">
                                            <h3>Raw output from {{ vuln.found_by|capitalize }}</h3>
                                            <div class="language-json highlighter-rouge">
                                                <div class="highlight"><pre
                                                        class="highlight"><code>{{ vuln.extra_metadata|pretty_json }}</code>
                                            </pre>
                                                </div>
                                            </div>
                                        {% endif %}
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}