{% extends 'base.jinja' %}
{% block title %}Archives vulnerability viewer{% endblock %}
{% block content %}
    <div class="page">
        {% include 'archives/header.jinja' %}
        <div class="page-wrapper">
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <h2 class="page-title">
                                {{ vuln_title }}
                            </h2><br>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page body -->
            <div class="page-body">
                <div class="container-xl">
                    {% include 'alerts.jinja' %}
                    <form action="/projects/{{ project.uuid }}/vulnerabilities/{{ vuln.uuid }}/attributes" method="POST"
                          enctype="multipart/form-data">
                        {{ csrf_input|safe }}
                        <div class="row row-cards row-deck">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">

                                            The following information relates to a vulnerability found on
                                            <b>{{ project.title }}</b>:
                                            {#                                        <br>#}
                                            {#                                        <br>#}
                                            {#                                        {{ vuln.description }}#}
                                        </h3>
                                    </div>
                                    <div class="card-footer">
                                        Vulnerability found at
                                        <b>{{ profile.localize_dt(vuln.created_at)|fmt('full') }}</b>
                                        <div class="float-end">
                                            <a href="/archives/{{ archive_uuid }}/vulnerabilities/{{ next_vuln_id }}">View
                                                Next Vulnerability</a>

                                        </div>
                                    </div>

                                    <div class="card-body">
                                        <div class="datagrid">
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Scanner</div>
                                                <div class="datagrid-content">{{ vuln.found_by|capitalize }}</div>
                                            </div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">State</div>
                                                <div class="datagrid-content">{{ vuln.state|capitalize }}</div>
                                            </div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Exploitability</div>
                                                <div class="datagrid-content">{{ vuln.exploitability|capitalize }}</div>
                                            </div>
                                            <div class="datagrid-item"></div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Impact</div>
                                                <div class="datagrid-content">{{ vuln.impact }}</div>
                                            </div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Likelihood</div>
                                                <div class="datagrid-content">{{ vuln.likelihood }}</div>
                                            </div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Severity</div>
                                                <div class="datagrid-content">{{ vuln.severity }}</div>
                                            </div>
                                            <div class="datagrid-item">
                                                <div class="datagrid-title">Confidence</div>
                                                <div class="datagrid-content">{{ vuln.confidence }}</div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="page-body">
                <div class="container-xl">
                    <div class="row justify-content-center">
                        <div class="card col-12">
                            <div class="card-body markdown">
                                <div class="card-header">
                                    <ul class="nav nav-tabs card-header-tabs" data-bs-toggle="tabs">
                                        <li class="nav-item">
                                            <a href="#tabs-home-1" class="nav-link active" data-bs-toggle="tab">Details</a>
                                        </li>
                                        {% if vuln.extra_metadata != {} %}
                                            <li class="nav-item">
                                                <a href="#tabs-output-1" class="nav-link" data-bs-toggle="tab">Raw
                                                    Output</a>
                                            </li>
                                        {% endif %}

                                    </ul>
                                </div>
                                <div class="card-body">
                                    <div class="tab-content">
                                        <div class="tab-pane active show" id="tabs-home-1">
                                        <h3>Vulnerability Details</h3>
                                            {% for line in vuln.description.splitlines() -%}
                                                <p>{{ line }}</p>
                                            {% endfor -%}
                                            <p>
                                                The issue lives on line <b>{{ vuln.code_line }}</b> within
                                                <b>{{ vuln.code_file }}</b>
                                            </p>
                                            <div class="highlight">
                                                <pre class="highlight">{{ vuln.code_context }}</pre>
                                            </div>
                                        <br>
                                            <h3>User provided notes on this vulnerability</h3>
                                            Any notes stored on this vulnerability will be provided below.
                                            <br>
                                            {{ csrf_input|safe }}
                                            <label for="notes"></label><textarea class="form-control" rows="8" name="notes" id="notes">{{ vuln.notes }}</textarea>
                                        </div>
                                        {% if vuln.extra_metadata != {} %}
                                            <div class="tab-pane" id="tabs-output-1">
                                            <h3>Raw output from {{ vuln.found_by|capitalize }}</h3>
                                            <div class="language-json highlighter-rouge">
                                                <div class="highlight"><pre
                                                        class="highlight">{{ vuln.extra_metadata|pretty_json }}
                                                </pre>
                                                </div>
                                            </div>
                                        {% endif %}
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}