{% extends 'base.jinja' %}
{% block title %}Hermes - {{ project.title }}{% endblock %}
{% block content %}
    <div class="page">
        {% include 'projects/header.jinja' %}
        <div class="page-wrapper">
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <h2 class="page-title">
                                {{ vuln_title }}
                            </h2><br>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page body -->
            <div class="page-body">
                <div class="container-xl">
                    {% include 'alerts.jinja' %}
                    <div class="row row-cards row-deck">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">

                                        The following information relates to a vulnerability found on
                                        <b>{{ project.title }}</b>:
                                        {#                                        <br>#}
                                        {#                                        <br>#}
                                        {#                                        {{ vuln.description }}#}
                                    </h3>
                                </div>
                                <div class="card-footer">
                                    Vulnerability found at <b>{{ profile.localize_dt(vuln.created_at)|fmt('full') }}</b>
                                </div>

                                <div class="card-body">
                                    <div class="datagrid">
                                        <div class="datagrid-item">
                                            <div class="datagrid-title">Scanner</div>
                                            <div class="datagrid-content">{{ vuln.found_by|capitalize }}</div>
                                        </div>
                                        {#                                        TODO Make these form elements as "Advanced select"#}
                                        <div class="datagrid-item">
                                            <div class="datagrid-title">State</div>
                                            <div class="datagrid-content">{{ vuln.state }}</div>
                                        </div>
                                        <div class="datagrid-item">
                                            <div class="datagrid-title">Exploitability</div>
                                            <div class="datagrid-content">{{ vuln.exploitability }}</div>
                                        </div>
                                        <div class="datagrid-item">
                                            <div class="datagrid-title">Review Next Vulnerability</div>
                                            <div class="datagrid-content"><a href="/projects/{{ project.uuid }}/vulnerabilities/{{ next_vuln_id }}">View Next</a></div>

                                        </div>
                                        <div class="datagrid-item">
                                            <div class="datagrid-title">Impact</div>
                                            <div class="datagrid-content">{{ vuln.impact }}</div>
                                        </div>
                                        <div class="datagrid-item">
                                            <div class="datagrid-title">Likelihood</div>
                                            <div class="datagrid-content">{{ vuln.likelihood }}</div>
                                        </div>
                                        <div class="datagrid-item">
                                            <div class="datagrid-title">Severity</div>
                                            <div class="datagrid-content">{{ vuln.severity }}</div>
                                        </div>
                                        <div class="datagrid-item">
                                            <div class="datagrid-title">Confidence</div>
                                            <div class="datagrid-content">{{ vuln.confidence }}</div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page-body">
                <div class="container-xl">
                    <div class="row justify-content-center">
                        <div class="card col-12">
                            <div class="card-body markdown">
                                <h1>Vulnerability details</h1>
                                    {% for line in vuln.description.splitlines() -%}
                                        <p>{{ line }}</p>
                                    {% endfor -%}
                                <p>
                                    The issue lives on line <b>{{ vuln.code_line }}</b> within <b>{{ vuln.code_file }}</b>
                                </p>
                                <div class="highlight"><pre class="highlight"><code>{{ vuln.code_context}}</code></pre>
                                    </div>
                                {% if vuln.notes %}
                                    <h2>User provided notes on this vulnerability</h2>
                                    <p>{{ vuln.notes }}</p>
                                {% endif %}
                                {% if vuln.extra_metadata != {} %}
                                    <hr>
                                    <h2>Raw output from {{ vuln.found_by|capitalize }}</h2>
                                    <div class="language-json highlighter-rouge">
                                    <div class="highlight">
                        <pre class="highlight"><code>{{ vuln.extra_metadata|pretty_json}}</code></pre>
                                    </div>
                                {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}